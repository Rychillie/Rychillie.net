---
title: useFetch um React Hook personalizado
summary: Um React Hook personalizado para buscar dados de uma API
publishedAt: '2024-03-21'
---

Fazer requisi√ß√µes HTTP em aplica√ß√µes React √© uma tarefa comum, mas nem sempre √© f√°cil. Com v√°rias op√ß√µes dispon√≠veis, como Axios e Fetch, escolher a abordagem certa pode ser um desafio. Para simplificar esse processo, apresento o Hook personalizado do React `useFetch`, uma solu√ß√£o elegante para lidar com requisi√ß√µes HTTP de maneira simples e reutiliz√°vel em seus projetos.

## Gerenciamento de Estado:

Para come√ßar com nosso Hook, criamos estados para controlar o carregamento de dados e poss√≠veis erros. Usando o `useState` do React, definimos os estados `data`, `isLoading` e `error`.

```tsx
const [data, setData] = useState();
const [isLoading, setIsLoading] = useState(false);
const [error, setError] = useState<Error | undefined>();
```

## Estado de dados:

O estado `data` armazena os dados recebidos da API. √â inicializado como `undefined` e atualizado quando a solicita√ß√£o √© bem-sucedida. Voc√™ tamb√©m pode optar por inicializar `data` com um valor padr√£o, se desejar. Al√©m disso, voc√™ pode definir o tipo de dados esperado para `data`.

## Estado de isLoading:

`isLoading` √© um booleano que indica se a solicita√ß√£o est√° em andamento. Ele √© `false` por padr√£o e muda para `true` durante a solicita√ß√£o, retornando para `false` quando ela √© conclu√≠da.

## Estado de erro:

O estado `error` armazena poss√≠veis erros que podem ocorrer durante a solicita√ß√£o. √â inicializado como `undefined` e atualizado com um objeto `Error` em caso de erro.

## Fun√ß√£o fetchData:

A fun√ß√£o `fetchData` √© respons√°vel por realizar a solicita√ß√£o √† API. √â uma fun√ß√£o ass√≠ncrona que utiliza o m√©todo `fetch` do JavaScript. No bloco `try`, realizamos a solicita√ß√£o e parseamos a resposta em um objeto JSON. Quaisquer erros s√£o capturados no bloco `catch` e armazenados no estado `error`. Finalmente, o estado `isLoading` √© atualizado para `false` no bloco `finally`.

```tsx
async function fetchData() {
  setIsLoading(true);
  try {
    const response = await fetch(url).then((res) => res.json());
    setData(response);
  } catch (error) {
    setError(error as Error);
  } finally {
    setIsLoading(false);
  }
}
```

## Usando useEffect:

Para realizar a solicita√ß√£o √† API, utilizamos o `useEffect` do React. Passamos a fun√ß√£o `fetchData` como primeiro argumento e a depend√™ncia `url` como segundo argumento. Isso garante que a solicita√ß√£o seja feita sempre que o `url` mudar.

```tsx
useEffect(() => {
  fetchData();
}, [url]);
```

## A fun√ß√£o refetch:

A fun√ß√£o `refetch` √© uma maneira de refazer manualmente a solicita√ß√£o √† API. Ela √© chamada quando queremos atualizar os dados, como por exemplo, quando o usu√°rio clica em um bot√£o de recarregar.

```tsx
function refetch() {
  setIsLoading(true);
  fetchData();
}
```

## C√≥digo Completo

Aqui est√° o c√≥digo completo para o nosso Hook personalizado do React `useFetch`:

```tsx
import { useEffect, useState } from 'react';

export default function useFetch(url: string) {
  const [data, setData] = useState();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | undefined>();

  async function fetchData() {
    setIsLoading(true);
    try {
      const response = await fetch(url).then((res) => res.json());
      setData(response);
    } catch (error) {
      setError(error as Error);
    } finally {
      setIsLoading(false);
    }
  }

  useEffect(() => {
    fetchData();
  }, [url]);

  function refetch() {
    setIsLoading(true);
    fetchData();
  }

  return { data, isLoading, error, refetch };
}
```

## Usando o Hook

Agora que o Hook est√° pronto, voc√™ pode us√°-lo em qualquer componente da sua aplica√ß√£o para fazer solicita√ß√µes √† API. Basta importar o Hook e chamar a fun√ß√£o `useFetch`, passando a `url` da API como argumento.

```tsx
import useFetch from './useFetch';

export default function List() {
  const { data, isLoading, error, refetch } = useFetch("YOUR_API_URL");

  if (isLoading) {
    return <p>Loading...</p>;
  }

  if (error) {
    return <p>Error: {error.message}</p>;
  }

  return (
    // Renderiza sua lista com os dados recebidos
  );
}
```

## Retorno do Hook

Por fim, retornamos um objeto contendo os estados `data`, `isLoading` e `error`, juntamente com a fun√ß√£o `refetch`. Isso nos permite usar este Hook em diferentes partes da aplica√ß√£o para fazer solicita√ß√µes de maneira simples e reutiliz√°vel.

## Conclus√£o

O Hook personalizado do React `useFetch` simplifica o processo de fazer requisi√ß√µes HTTP em aplica√ß√µes React. Com uma estrutura clara e funcionalidades bem definidas, ele possibilita um desenvolvimento mais eficiente e organizado. Experimente o `useFetch` em seu pr√≥ximo projeto e veja como ele pode facilitar sua vida!

Espero que este artigo tenha sido √∫til para voc√™. Se tiver qualquer d√∫vida ou sugest√£o, n√£o hesite em entrar em contato. Obrigado por ler at√© aqui e at√© a pr√≥xima! üöÄ
